
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="X-UA-Compatible" content="IE=Edge" />
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>Spark &#8212; Bookmarks rc documentation</title>
    <link rel="stylesheet" href="../../_static/alabaster.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    <script type="text/javascript" id="documentation_options" data-url_root="../../" src="../../_static/documentation_options.js"></script>
    <script type="text/javascript" src="../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../_static/doctools.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="Cisco" href="../../src/Cisco.html" />
    <link rel="prev" title="SBT" href="sbt.html" />
   
  <link rel="stylesheet" href="../../_static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head><body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <div class="section" id="spark">
<span id="spark"></span><h1>Spark<a class="headerlink" href="#spark" title="Permalink to this headline">¶</a></h1>
<div class="section" id="api">
<span id="api"></span><h2>API<a class="headerlink" href="#api" title="Permalink to this headline">¶</a></h2>
<p>Check out the Spark API here for digging into much of what will be
mentioned in the section below.</p>
<p>https://spark.apache.org/docs/2.1.0/api/scala/index.html</p>
</div>
<div class="section" id="config">
<span id="config"></span><h2>Config<a class="headerlink" href="#config" title="Permalink to this headline">¶</a></h2>
<p>You can configure spark to run locally when developing a script using the following
configuration.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">org.apache.spark.SparkConf</span>
<span class="kn">import</span> <span class="nn">org.apache.spark.SparkContext</span>
<span class="kn">import</span> <span class="nn">org.apache.spark.SparkContext._</span>

<span class="n">val</span> <span class="n">conf</span><span class="p">:</span> <span class="n">SparkConf</span> <span class="o">=</span> <span class="n">new</span> <span class="n">SparkConf</span><span class="p">()</span><span class="o">.</span><span class="n">setMaster</span><span class="p">(</span><span class="s2">&quot;local&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">setAppName</span><span class="p">(</span><span class="s2">&quot;Wikipedia Ranking&quot;</span><span class="p">)</span>
<span class="n">val</span> <span class="n">sc</span><span class="p">:</span> <span class="n">SparkContext</span> <span class="o">=</span> <span class="n">new</span> <span class="n">SparkContext</span><span class="p">(</span><span class="n">conf</span><span class="p">)</span>
</pre></div>
</div>
<p>After running the above you will also get an output that tells you the sparkUI has started
and you can visit is on port 4040 in your local browser for troubleshooting.</p>
</div>
<div class="section" id="rdds">
<span id="rdds"></span><h2>RDDs<a class="headerlink" href="#rdds" title="Permalink to this headline">¶</a></h2>
<p>Resilient Distributed Dataset are immutable collections of data that are designed to be operated
on in parallel. Below is an example of how to create a dataset from a file and then parse is into
an object using map.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">org.apache.spark.SparkConf</span>
<span class="kn">import</span> <span class="nn">org.apache.spark.SparkContext</span>
<span class="kn">import</span> <span class="nn">org.apache.spark.SparkContext._</span>

<span class="kn">import</span> <span class="nn">org.apache.spark.rdd.RDD</span>

<span class="n">val</span> <span class="n">wikiRdd</span><span class="p">:</span> <span class="n">RDD</span><span class="p">[</span><span class="n">WikipediaArticle</span><span class="p">]</span> <span class="o">=</span> <span class="n">sc</span><span class="o">.</span><span class="n">textFile</span><span class="p">(</span><span class="n">WikipediaData</span><span class="o">.</span><span class="n">filePath</span><span class="p">)</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="n">WikipediaData</span><span class="o">.</span><span class="n">parse</span> <span class="n">_</span><span class="p">)</span>
</pre></div>
</div>
<p>For testing purposes you can also create an RDD using the following.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">val</span> <span class="n">rdd</span><span class="p">:</span> <span class="n">RDD</span><span class="p">[</span><span class="n">Tuple2</span><span class="p">[</span><span class="n">String</span><span class="p">,</span> <span class="n">String</span><span class="p">]]</span> <span class="o">=</span> <span class="n">sc</span><span class="o">.</span><span class="n">parallelize</span><span class="p">(</span><span class="n">List</span><span class="p">(</span>
  <span class="p">(</span><span class="s2">&quot;I&quot;</span><span class="p">,</span> <span class="s2">&quot;India&quot;</span><span class="p">),</span>
  <span class="p">(</span><span class="s2">&quot;U&quot;</span><span class="p">,</span> <span class="s2">&quot;USA&quot;</span><span class="p">),</span>
  <span class="p">(</span><span class="s2">&quot;W&quot;</span><span class="p">,</span> <span class="s2">&quot;West&quot;</span><span class="p">)))</span>
</pre></div>
</div>
<p>I have included the type of <code class="docutils literal notranslate"><span class="pre">RDD[Tuple2[String,</span> <span class="pre">String]]</span></code> to show you a few things. First that
the <code class="docutils literal notranslate"><span class="pre">parallelize</span></code> function takes a <code class="docutils literal notranslate"><span class="pre">List</span></code> but returns an RDD and second that scala has a <code class="docutils literal notranslate"><span class="pre">Tuple*</span></code>
type. This goes from <code class="docutils literal notranslate"><span class="pre">Tuple1</span></code> to <code class="docutils literal notranslate"><span class="pre">Tuple22</span></code>. You can read more about this here.</p>
<p>https://underscore.io/blog/posts/2016/10/11/twenty-two.html</p>
<p>Note that you can also use <code class="docutils literal notranslate"><span class="pre">sample</span></code> or <code class="docutils literal notranslate"><span class="pre">takeSample</span></code> to return a sub-section of the RDD when you
are trying to write some code that utilizes it.</p>
</div>
<div class="section" id="pair-rdds">
<span id="pair-rdds"></span><h2>Pair RDDs<a class="headerlink" href="#pair-rdds" title="Permalink to this headline">¶</a></h2>
<p>Pair RDDs are very similar to normal RDDs except they offer a few additional functions
that let you take advantage of the key more easily.</p>
<p>Here is an example of how to create one.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">val</span> <span class="n">rdd</span><span class="p">:</span> <span class="n">RDD</span><span class="p">[</span><span class="n">Tuple2</span><span class="p">[</span><span class="n">String</span><span class="p">,</span> <span class="n">String</span><span class="p">]]</span> <span class="o">=</span> <span class="n">sc</span><span class="o">.</span><span class="n">parallelize</span><span class="p">(</span><span class="n">List</span><span class="p">(</span>
  <span class="p">(</span><span class="s2">&quot;I&quot;</span><span class="p">,</span> <span class="s2">&quot;India&quot;</span><span class="p">),</span>
  <span class="p">(</span><span class="s2">&quot;U&quot;</span><span class="p">,</span> <span class="s2">&quot;USA&quot;</span><span class="p">),</span>
  <span class="p">(</span><span class="s2">&quot;I&quot;</span><span class="p">,</span> <span class="s2">&quot;Inga&quot;</span><span class="p">),</span>
  <span class="p">(</span><span class="s2">&quot;W&quot;</span><span class="p">,</span> <span class="s2">&quot;West&quot;</span><span class="p">)))</span>
</pre></div>
</div>
<p>You may notice the RDD in the <code class="docutils literal notranslate"><span class="pre">RDDs</span></code> section is infact a pair RDD as well. You can take
advantage of this with the following methods <code class="docutils literal notranslate"><span class="pre">reduceByKey</span></code>, <code class="docutils literal notranslate"><span class="pre">groupByKey</span></code>, and <code class="docutils literal notranslate"><span class="pre">join</span></code>.</p>
<p><code class="docutils literal notranslate"><span class="pre">groupByKey</span></code></p>
<p>Collect is only called below because without it nothing actually would happen.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">val</span> <span class="n">rdd</span><span class="p">:</span> <span class="n">RDD</span><span class="p">[</span><span class="n">Tuple2</span><span class="p">[</span><span class="n">String</span><span class="p">,</span> <span class="n">String</span><span class="p">]]</span> <span class="o">=</span> <span class="n">sc</span><span class="o">.</span><span class="n">parallelize</span><span class="p">(</span><span class="n">List</span><span class="p">(</span>
  <span class="p">(</span><span class="s2">&quot;I&quot;</span><span class="p">,</span> <span class="s2">&quot;India&quot;</span><span class="p">),</span>
  <span class="p">(</span><span class="s2">&quot;U&quot;</span><span class="p">,</span> <span class="s2">&quot;USA&quot;</span><span class="p">),</span>
  <span class="p">(</span><span class="s2">&quot;I&quot;</span><span class="p">,</span> <span class="s2">&quot;Inga&quot;</span><span class="p">),</span>
  <span class="p">(</span><span class="s2">&quot;W&quot;</span><span class="p">,</span> <span class="s2">&quot;West&quot;</span><span class="p">)))</span>

<span class="n">rdd</span><span class="o">.</span><span class="n">groupByKey</span><span class="p">()</span><span class="o">.</span><span class="n">collect</span><span class="p">()</span>
<span class="c1"># res17: Array[(String, Iterable[String])] = Array((I,CompactBuffer(India, Inga)), (U,CompactBuffer(USA)), (W,CompactBuffer(West)))</span>
</pre></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">reduceByKey</span></code></p>
<p>This is another contrived example but just serves to show you how to call it.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">val</span> <span class="n">rdd</span><span class="p">:</span> <span class="n">RDD</span><span class="p">[</span><span class="n">Tuple2</span><span class="p">[</span><span class="n">String</span><span class="p">,</span> <span class="n">Int</span><span class="p">]]</span> <span class="o">=</span> <span class="n">sc</span><span class="o">.</span><span class="n">parallelize</span><span class="p">(</span><span class="n">List</span><span class="p">(</span>
  <span class="p">(</span><span class="s2">&quot;I&quot;</span><span class="p">,</span> <span class="mi">10</span><span class="p">),</span>
  <span class="p">(</span><span class="s2">&quot;U&quot;</span><span class="p">,</span> <span class="mi">23</span><span class="p">),</span>
  <span class="p">(</span><span class="s2">&quot;I&quot;</span><span class="p">,</span> <span class="mi">42</span><span class="p">),</span>
  <span class="p">(</span><span class="s2">&quot;W&quot;</span><span class="p">,</span> <span class="mi">24</span><span class="p">)))</span>

<span class="n">rdd</span><span class="o">.</span><span class="n">reduceByKey</span><span class="p">(</span><span class="n">_</span> <span class="o">+</span> <span class="n">_</span><span class="p">)</span><span class="o">.</span><span class="n">collect</span><span class="p">()</span>
<span class="c1"># res0: Array[(String, Int)] = Array((I,52), (U,23), (W,24))</span>
</pre></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">mapValue</span></code></p>
<p>This allows you to apply a function or whatever to each value in a pair RDD.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">val</span> <span class="n">rdd</span><span class="p">:</span> <span class="n">RDD</span><span class="p">[</span><span class="n">Tuple2</span><span class="p">[</span><span class="n">String</span><span class="p">,</span> <span class="n">Int</span><span class="p">]]</span> <span class="o">=</span> <span class="n">sc</span><span class="o">.</span><span class="n">parallelize</span><span class="p">(</span><span class="n">List</span><span class="p">(</span>
  <span class="p">(</span><span class="s2">&quot;I&quot;</span><span class="p">,</span> <span class="mi">10</span><span class="p">),</span>
  <span class="p">(</span><span class="s2">&quot;U&quot;</span><span class="p">,</span> <span class="mi">23</span><span class="p">),</span>
  <span class="p">(</span><span class="s2">&quot;I&quot;</span><span class="p">,</span> <span class="mi">42</span><span class="p">),</span>
  <span class="p">(</span><span class="s2">&quot;W&quot;</span><span class="p">,</span> <span class="mi">24</span><span class="p">)))</span>

<span class="n">rdd</span><span class="o">.</span><span class="n">mapValues</span><span class="p">(</span><span class="n">_</span> <span class="o">*</span> <span class="mi">2</span><span class="p">)</span><span class="o">.</span><span class="n">collect</span><span class="p">()</span>
<span class="c1"># res6: Array[(String, Int)] = Array((I,20), (U,46), (I,84), (W,48))</span>
</pre></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">countByKey</span></code></p>
<p>Count number of elements that each key has.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">val</span> <span class="n">rdd</span><span class="p">:</span> <span class="n">RDD</span><span class="p">[</span><span class="n">Tuple2</span><span class="p">[</span><span class="n">String</span><span class="p">,</span> <span class="n">Int</span><span class="p">]]</span> <span class="o">=</span> <span class="n">sc</span><span class="o">.</span><span class="n">parallelize</span><span class="p">(</span><span class="n">List</span><span class="p">(</span>
  <span class="p">(</span><span class="s2">&quot;I&quot;</span><span class="p">,</span> <span class="mi">10</span><span class="p">),</span>
  <span class="p">(</span><span class="s2">&quot;U&quot;</span><span class="p">,</span> <span class="mi">23</span><span class="p">),</span>
  <span class="p">(</span><span class="s2">&quot;I&quot;</span><span class="p">,</span> <span class="mi">42</span><span class="p">),</span>
  <span class="p">(</span><span class="s2">&quot;W&quot;</span><span class="p">,</span> <span class="mi">24</span><span class="p">)))</span>

<span class="n">rdd</span><span class="o">.</span><span class="n">countByKey</span><span class="p">()</span>
<span class="c1"># res13: scala.collection.Map[String,Long] = Map(I -&gt; 2, U -&gt; 1, W -&gt; 1) </span>
</pre></div>
</div>
</div>
<div class="section" id="rdds-and-joins">
<span id="rdds-and-joins"></span><h2>RDDs and Joins<a class="headerlink" href="#rdds-and-joins" title="Permalink to this headline">¶</a></h2>
<p>Here is an example of the <code class="docutils literal notranslate"><span class="pre">join</span></code> function in spark which is actually an inner join.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">val</span> <span class="n">rdd1</span> <span class="o">=</span> <span class="n">sc</span><span class="o">.</span><span class="n">parallelize</span><span class="p">(</span><span class="n">List</span><span class="p">((</span><span class="mi">1</span><span class="p">,</span> <span class="s2">&quot;Mike&quot;</span><span class="p">),</span> <span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="s2">&quot;Abby&quot;</span><span class="p">),</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="s2">&quot;Jeff&quot;</span><span class="p">),</span> <span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="s2">&quot;Harry&quot;</span><span class="p">),</span> <span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="s2">&quot;Potter&quot;</span><span class="p">)))</span>
<span class="n">val</span> <span class="n">rdd2</span> <span class="o">=</span> <span class="n">sc</span><span class="o">.</span><span class="n">parallelize</span><span class="p">(</span><span class="n">List</span><span class="p">((</span><span class="mi">1</span><span class="p">,</span> <span class="p">(</span><span class="s2">&quot;A&quot;</span><span class="p">,</span> <span class="s2">&quot;B&quot;</span><span class="p">)),</span> <span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="p">(</span><span class="s2">&quot;B&quot;</span><span class="p">,</span> <span class="s2">&quot;B&quot;</span><span class="p">)),</span> <span class="p">(</span><span class="mi">6</span><span class="p">,</span> <span class="p">(</span><span class="s2">&quot;C&quot;</span><span class="p">,</span> <span class="s2">&quot;B&quot;</span><span class="p">)),</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="p">(</span><span class="s2">&quot;Z&quot;</span><span class="p">,</span> <span class="s2">&quot;T&quot;</span><span class="p">))))</span>

<span class="n">rdd1</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">rdd2</span><span class="p">)</span><span class="o">.</span><span class="n">collect</span><span class="p">()</span>
<span class="c1"># res19: Array[(Int, (String, (String, String)))] = Array((1,(Mike,(A,B))), (1,(Mike,(Z,T))), (1,(Jeff,(A,B))), (1,(Jeff,(Z,T))), (5,(Potter,(B,B))))</span>
</pre></div>
</div>
<p>The important thing to note is that the keys with 4 and 6 in them are no longer in the list. This is because
it had nothing in common with the other list so it was dropped.</p>
<p>Outer joins allow you to pick what data is most important to you see the following example.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">val</span> <span class="n">rdd1</span> <span class="o">=</span> <span class="n">sc</span><span class="o">.</span><span class="n">parallelize</span><span class="p">(</span><span class="n">List</span><span class="p">((</span><span class="mi">1</span><span class="p">,</span> <span class="s2">&quot;Mike&quot;</span><span class="p">),</span> <span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="s2">&quot;Abby&quot;</span><span class="p">),</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="s2">&quot;Jeff&quot;</span><span class="p">),</span> <span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="s2">&quot;Harry&quot;</span><span class="p">),</span> <span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="s2">&quot;Potter&quot;</span><span class="p">)))</span>
<span class="n">val</span> <span class="n">rdd2</span> <span class="o">=</span> <span class="n">sc</span><span class="o">.</span><span class="n">parallelize</span><span class="p">(</span><span class="n">List</span><span class="p">((</span><span class="mi">1</span><span class="p">,</span> <span class="p">(</span><span class="s2">&quot;A&quot;</span><span class="p">,</span> <span class="s2">&quot;B&quot;</span><span class="p">)),</span> <span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="p">(</span><span class="s2">&quot;B&quot;</span><span class="p">,</span> <span class="s2">&quot;B&quot;</span><span class="p">)),</span> <span class="p">(</span><span class="mi">6</span><span class="p">,</span> <span class="p">(</span><span class="s2">&quot;C&quot;</span><span class="p">,</span> <span class="s2">&quot;B&quot;</span><span class="p">)),</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="p">(</span><span class="s2">&quot;Z&quot;</span><span class="p">,</span> <span class="s2">&quot;T&quot;</span><span class="p">))))</span>

<span class="n">rdd1</span><span class="o">.</span><span class="n">leftOuterJoin</span><span class="p">(</span><span class="n">rdd2</span><span class="p">)</span><span class="o">.</span><span class="n">collect</span><span class="p">()</span>
<span class="c1"># res1: Array[(Int, (String, Option[(String, String)]))] = Array((4,(Harry,None)), (1,(Mike,Some((A,B)))), (1,(Mike,Some((Z,T)))), (1,(Jeff,Some((A,B)))), (1,(Jeff,Some((Z,T)))), (5,(Potter,Some((B,B)))), (2,(Abby,None)))</span>
</pre></div>
</div>
<p>With left outter join we have told it that we care most about the data on “left” or rdd1 in this case.
As you can see the key of 4 has been included in the computed list with an extra value of None added
since it had nothing to join with.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">val</span> <span class="n">rdd1</span> <span class="o">=</span> <span class="n">sc</span><span class="o">.</span><span class="n">parallelize</span><span class="p">(</span><span class="n">List</span><span class="p">((</span><span class="mi">1</span><span class="p">,</span> <span class="s2">&quot;Mike&quot;</span><span class="p">),</span> <span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="s2">&quot;Abby&quot;</span><span class="p">),</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="s2">&quot;Jeff&quot;</span><span class="p">),</span> <span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="s2">&quot;Harry&quot;</span><span class="p">),</span> <span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="s2">&quot;Potter&quot;</span><span class="p">)))</span>
<span class="n">val</span> <span class="n">rdd2</span> <span class="o">=</span> <span class="n">sc</span><span class="o">.</span><span class="n">parallelize</span><span class="p">(</span><span class="n">List</span><span class="p">((</span><span class="mi">1</span><span class="p">,</span> <span class="p">(</span><span class="s2">&quot;A&quot;</span><span class="p">,</span> <span class="s2">&quot;B&quot;</span><span class="p">)),</span> <span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="p">(</span><span class="s2">&quot;B&quot;</span><span class="p">,</span> <span class="s2">&quot;B&quot;</span><span class="p">)),</span> <span class="p">(</span><span class="mi">6</span><span class="p">,</span> <span class="p">(</span><span class="s2">&quot;C&quot;</span><span class="p">,</span> <span class="s2">&quot;B&quot;</span><span class="p">)),</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="p">(</span><span class="s2">&quot;Z&quot;</span><span class="p">,</span> <span class="s2">&quot;T&quot;</span><span class="p">))))</span>

<span class="n">rdd1</span><span class="o">.</span><span class="n">leftOuterJoin</span><span class="p">(</span><span class="n">rdd2</span><span class="p">)</span><span class="o">.</span><span class="n">collect</span><span class="p">()</span>
<span class="c1"># res2: Array[(Int, (Option[String], (String, String)))] = Array((1,(Some(Mike),(A,B))), (1,(Some(Mike),(Z,T))), (1,(Some(Jeff),(A,B))), (1,(Some(Jeff),(Z,T))), (6,(None,(C,B))), (5,(Some(Potter),(B,B))))</span>
</pre></div>
</div>
<p>This is doing the same as left join except we have decided that rdd2 is the data we care about so
the key of 6 has been included in the output and 4 has been dropped.</p>
</div>
<div class="section" id="shuffling">
<span id="shuffling"></span><h2>Shuffling<a class="headerlink" href="#shuffling" title="Permalink to this headline">¶</a></h2>
<p>Shuffling is important to consider when performing operations on RDDs. Take for example the case that you
have 10 nodes and an RDD in the form of <code class="docutils literal notranslate"><span class="pre">(Key,</span> <span class="pre">Value)</span></code> that has been partitioned across the cluster. If you
wanted to <code class="docutils literal notranslate"><span class="pre">groupByKey</span></code> each node in the cluster has to talk to each and every other node in the cluster to
find out what Values belong to what Key. This is a lot of network traffic if you have large sets of data. If
you instead reducedByKey it will reduce locally before talking over the network so instead of every <code class="docutils literal notranslate"><span class="pre">(Key,</span> <span class="pre">Value)</span></code>
pair needing to make a network call you are only doing it once per node in the form of <code class="docutils literal notranslate"><span class="pre">(Key,</span> <span class="pre">(Values))</span></code> after
your reduce has finished.</p>
<p>The following functions might cause shuffles.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">cogroup</span>
<span class="n">groupWith</span>
<span class="n">join</span>
<span class="n">leftOuterJoin</span>
<span class="n">rightOuterJoin</span>
<span class="n">groupByKey</span>
<span class="n">reduceByKey</span>
<span class="n">combineByKey</span>
<span class="n">distinct</span>
<span class="n">intersection</span>
<span class="n">repartition</span>
<span class="n">coalesce</span>
</pre></div>
</div>
</div>
<div class="section" id="partitioning">
<span id="partitioning"></span><h2>Partitioning<a class="headerlink" href="#partitioning" title="Permalink to this headline">¶</a></h2>
<p>You can partition your data in a few different ways in Spark depending on what makes sense. The most
common are range partitioning and hash partitioning.</p>
<p>Here is an example of range partitioning.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">org.apache.spark.RangePartitioner</span>

<span class="n">val</span> <span class="n">rdd</span><span class="p">:</span> <span class="n">RDD</span><span class="p">[</span><span class="n">Tuple2</span><span class="p">[</span><span class="n">String</span><span class="p">,</span> <span class="n">String</span><span class="p">]]</span> <span class="o">=</span> <span class="n">sc</span><span class="o">.</span><span class="n">parallelize</span><span class="p">(</span><span class="n">List</span><span class="p">(</span>
  <span class="p">(</span><span class="s2">&quot;I&quot;</span><span class="p">,</span> <span class="s2">&quot;India&quot;</span><span class="p">),</span>
  <span class="p">(</span><span class="s2">&quot;U&quot;</span><span class="p">,</span> <span class="s2">&quot;USA&quot;</span><span class="p">),</span>
  <span class="p">(</span><span class="s2">&quot;W&quot;</span><span class="p">,</span> <span class="s2">&quot;West&quot;</span><span class="p">)))</span>

<span class="n">val</span> <span class="n">rp</span> <span class="o">=</span> <span class="n">new</span> <span class="n">RangePartitioner</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="n">rdd</span><span class="p">)</span>
<span class="n">val</span> <span class="n">parts</span> <span class="o">=</span> <span class="n">rdd</span><span class="o">.</span><span class="n">partitionBy</span><span class="p">(</span><span class="n">rp</span><span class="p">)</span><span class="o">.</span><span class="n">cache</span><span class="p">()</span>

<span class="o">//</span> <span class="n">This</span> <span class="n">will</span> <span class="n">let</span> <span class="n">you</span> <span class="n">peek</span> <span class="n">inside</span> <span class="n">each</span> <span class="n">partition</span> <span class="n">to</span> <span class="n">see</span> <span class="n">what</span> <span class="ow">is</span> <span class="n">going</span> <span class="n">on</span>
<span class="o">//</span> <span class="k">try</span> <span class="n">changing</span> <span class="n">the</span> <span class="n">partition</span> <span class="n">size</span> <span class="ow">and</span> <span class="n">see</span> <span class="n">what</span> <span class="n">happens</span>
<span class="n">parts</span><span class="o">.</span><span class="n">mapPartitionsWithIndex</span><span class="p">(</span> <span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span> <span class="n">println</span><span class="p">(</span><span class="n">x</span><span class="p">);</span> <span class="n">y</span><span class="o">.</span><span class="n">foreach</span><span class="p">(</span><span class="n">println</span><span class="p">);</span> <span class="n">y</span> <span class="p">}</span> <span class="p">)</span><span class="o">.</span><span class="n">collect</span><span class="p">()</span>
</pre></div>
</div>
<p>The following is how you would use a Hash partitioner that has 3 partitions.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">org.apache.spark.HashPartitioner</span>

<span class="n">val</span> <span class="n">rp</span> <span class="o">=</span> <span class="n">new</span> <span class="n">HashPartitioner</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
<span class="n">val</span> <span class="n">parts</span> <span class="o">=</span> <span class="n">rdd</span><span class="o">.</span><span class="n">partitionBy</span><span class="p">(</span><span class="n">rp</span><span class="p">)</span><span class="o">.</span><span class="n">cache</span><span class="p">()</span>
</pre></div>
</div>
<p>When you have a partitioned set of data you can perform most operations except <code class="docutils literal notranslate"><span class="pre">map</span></code> or <code class="docutils literal notranslate"><span class="pre">flatMap</span></code>.
This is because you can alter the keys of the partition when running these which is extreamly
expensive.</p>
</div>
<div class="section" id="caching">
<span id="caching"></span><h2>Caching<a class="headerlink" href="#caching" title="Permalink to this headline">¶</a></h2>
<p>By default an RDD is recomputed everytime you run an action on it. If your RDD is not going to change
you likely will want to cache it in memory so multiple operations can be run without the performance
hit of loading it into memory.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">val</span> <span class="n">rdd</span><span class="p">:</span> <span class="n">RDD</span><span class="p">[</span><span class="n">Tuple2</span><span class="p">[</span><span class="n">String</span><span class="p">,</span> <span class="n">String</span><span class="p">]]</span> <span class="o">=</span> <span class="n">sc</span><span class="o">.</span><span class="n">parallelize</span><span class="p">(</span><span class="n">List</span><span class="p">(</span>
  <span class="p">(</span><span class="s2">&quot;I&quot;</span><span class="p">,</span> <span class="s2">&quot;India&quot;</span><span class="p">),</span>
  <span class="p">(</span><span class="s2">&quot;U&quot;</span><span class="p">,</span> <span class="s2">&quot;USA&quot;</span><span class="p">),</span>
  <span class="p">(</span><span class="s2">&quot;W&quot;</span><span class="p">,</span> <span class="s2">&quot;West&quot;</span><span class="p">)))</span><span class="o">.</span><span class="n">cache</span><span class="p">()</span>
</pre></div>
</div>
<p>You can also use <code class="docutils literal notranslate"><span class="pre">persist</span></code> instead of <code class="docutils literal notranslate"><span class="pre">cache</span></code> if you so fancy.</p>
<p>A benifit of using cache can be seen in the following example of code.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">val</span> <span class="n">rdd</span><span class="p">:</span> <span class="n">RDD</span><span class="p">[</span><span class="n">Tuple2</span><span class="p">[</span><span class="n">String</span><span class="p">,</span> <span class="n">String</span><span class="p">]]</span> <span class="o">=</span> <span class="n">sc</span><span class="o">.</span><span class="n">parallelize</span><span class="p">(</span><span class="n">List</span><span class="p">(</span>
  <span class="p">(</span><span class="s2">&quot;I&quot;</span><span class="p">,</span> <span class="s2">&quot;India&quot;</span><span class="p">),</span>
  <span class="p">(</span><span class="s2">&quot;U&quot;</span><span class="p">,</span> <span class="s2">&quot;USA&quot;</span><span class="p">),</span>
  <span class="p">(</span><span class="s2">&quot;W&quot;</span><span class="p">,</span> <span class="s2">&quot;West&quot;</span><span class="p">)))</span>

<span class="n">val</span> <span class="n">xx</span> <span class="o">=</span> <span class="n">rdd</span><span class="o">.</span><span class="n">flatMap</span><span class="p">(</span> <span class="n">x</span> <span class="o">=&gt;</span> <span class="n">x</span><span class="o">.</span><span class="n">_1</span> <span class="o">+</span> <span class="n">x</span><span class="o">.</span><span class="n">_2</span><span class="p">)</span><span class="o">.</span><span class="n">cache</span><span class="p">()</span>

<span class="n">xx</span><span class="o">.</span><span class="n">collect</span><span class="p">()</span>
<span class="n">xx</span><span class="o">.</span><span class="n">count</span><span class="p">()</span>
</pre></div>
</div>
<p>If we had not called <code class="docutils literal notranslate"><span class="pre">cache</span></code> when making the rdd xx would have been computes twice.
Once for when we called collect and once when we called count. However since it was
cached the rdd is only loaded once.</p>
<p>Read more about it here https://stackoverflow.com/questions/28981359/why-do-we-need-to-call-cache-or-persist-on-a-rdd</p>
</div>
<div class="section" id="debug-workflow">
<span id="debug-workflow"></span><h2>Debug Workflow<a class="headerlink" href="#debug-workflow" title="Permalink to this headline">¶</a></h2>
<p>After reading all of the above you are likely now concerned that you have written some super shitty
scala code that is constantly shuffling data. The bad news is you 100% did but the good news is that
you have a few functions to debug it.</p>
<p>On any RDD you can call the function <code class="docutils literal notranslate"><span class="pre">dependencies</span></code> which will output a high level list of operations
that are about to be performed. You can all use <code class="docutils literal notranslate"><span class="pre">toDebugString</span></code> which will give you a little more
insight into what is happening.</p>
</div>
</div>


          </div>
          
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<h1 class="logo"><a href="../../index.html">Bookmarks</a></h1>








<h3>Navigation</h3>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../ciscocatalyst3560G.html">Cisco Catalyst 3560G Config</a></li>
<li class="toctree-l1"><a class="reference internal" href="../ciscocatalyst3560G.html#set-cisco-banner-motd">Set Cisco Banner (motd)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../ciscocatalyst3560G.html#enable-lldp">Enable LLDP</a></li>
<li class="toctree-l1"><a class="reference internal" href="../ciscocatalyst3560G.html#set-hostname-dns">Set Hostname &amp; DNS</a></li>
<li class="toctree-l1"><a class="reference internal" href="../ciscocatalyst3560G.html#setup-ssh">Setup SSH</a></li>
<li class="toctree-l1"><a class="reference internal" href="../ciscocatalyst3560G.html#list-interfaces">List interfaces</a></li>
<li class="toctree-l1"><a class="reference internal" href="../ciscocatalyst3560G.html#vlans">VLANs</a></li>
<li class="toctree-l1"><a class="reference internal" href="../ciscocatalyst3560G.html#configure-dhcp">Configure DHCP</a></li>
<li class="toctree-l1"><a class="reference internal" href="../ciscocatalyst3560G.html#dhcp-forwarding">DHCP Forwarding</a></li>
<li class="toctree-l1"><a class="reference internal" href="../ciscocatalyst3560G.html#random">Random</a></li>
<li class="toctree-l1"><a class="reference internal" href="../ciscocatalyst3560G.html#get-system-temp-info">Get System Temp Info</a></li>
<li class="toctree-l1"><a class="reference internal" href="../collins.html">Collins</a></li>
<li class="toctree-l1"><a class="reference internal" href="../collins.html#creating-a-node-classifier">Creating a node classifier</a></li>
<li class="toctree-l1"><a class="reference internal" href="../djbdns.html">djbdns (How to setup your own DNS)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../mooltipass.html">Mooltipass</a></li>
<li class="toctree-l1"><a class="reference internal" href="../stickybits.html">SUID/GUID Quirks</a></li>
<li class="toctree-l1"><a class="reference internal" href="../stickybits.html#suid-guid-example">SUID/GUID Example</a></li>
<li class="toctree-l1"><a class="reference internal" href="../stickybits.html#stick-bit">Stick Bit</a></li>
<li class="toctree-l1"><a class="reference internal" href="../ruby/ioctl.html">ioctl in Ruby</a></li>
<li class="toctree-l1"><a class="reference internal" href="1.html">Scala Core Functions Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="k-means.html">K-Means</a></li>
<li class="toctree-l1"><a class="reference internal" href="sbt.html">SBT</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Spark</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#api">API</a></li>
<li class="toctree-l2"><a class="reference internal" href="#config">Config</a></li>
<li class="toctree-l2"><a class="reference internal" href="#rdds">RDDs</a></li>
<li class="toctree-l2"><a class="reference internal" href="#pair-rdds">Pair RDDs</a></li>
<li class="toctree-l2"><a class="reference internal" href="#rdds-and-joins">RDDs and Joins</a></li>
<li class="toctree-l2"><a class="reference internal" href="#shuffling">Shuffling</a></li>
<li class="toctree-l2"><a class="reference internal" href="#partitioning">Partitioning</a></li>
<li class="toctree-l2"><a class="reference internal" href="#caching">Caching</a></li>
<li class="toctree-l2"><a class="reference internal" href="#debug-workflow">Debug Workflow</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../src/Cisco.html">Cisco</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../src/Dependencies.html">Dependencies</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../src/Dependencies.html#debian">Debian</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../src/Distributed_Systems.html">Distributed Systems</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../src/Distributed_Systems.html#op-ed-s">Op-ed’s</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../src/Docker.html">Docker</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../src/Docker.html#stats-api">Stats API</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../src/Docker.html#monitoring">Monitoring</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../src/Languages.html">Languages</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../src/Linux.html">Linux</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../src/Linux.html#kernel-internals">Kernel Internals</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../src/Linux.html#ipmi">IPMI</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../src/Linux.html#networking">Networking</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../src/Linux.html#perf-tuning">Perf Tuning</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../src/Michael.html">Michael</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../src/OS.html">OS</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../src/OS.html#courses">Courses</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../src/Philosophy.html">Philosophy</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../src/Ruby.html">Ruby</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../src/Ruby.html#educational">Educational</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../src/Security.html">Security</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../src/Security.html#rowhammer">Rowhammer</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../src/Security.html#vpn">VPN</a></li>
</ul>

<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="../../index.html">Documentation overview</a><ul>
      <li>Previous: <a href="sbt.html" title="previous chapter">SBT</a></li>
      <li>Next: <a href="../../src/Cisco.html" title="next chapter">Cisco</a></li>
  </ul></li>
</ul>
</div>
<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    </div>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &copy;2018, Michael Schuett.
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 1.7.9</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.11</a>
      
      |
      <a href="../../_sources/notes/scala/spark.md.txt"
          rel="nofollow">Page source</a>
    </div>

    

    
  </body>
</html>