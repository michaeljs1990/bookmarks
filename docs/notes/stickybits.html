
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="X-UA-Compatible" content="IE=Edge" />
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>} &#8212; Bookmarks rc documentation</title>
    <link rel="stylesheet" href="../_static/alabaster.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
   
  <link rel="stylesheet" href="../_static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head><body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <p>Inspired by <a class="reference external" href="https://twitter.com/b0rk/status/801233053699940352">https://twitter.com/b0rk/status/801233053699940352</a></p>
<p># SUID/GUID Quirks</p>
<p>This will cover some of the quirks of linux file permissions that I often forget.</p>
<p>First note that if you are trying to use SUID or GUID on a filesystem you need to check if nosuid is set. You can easily test
for this by running <cite>mount | grep /filesystem</cite> which will show all the mount params for the given filesystem. If you see
nosuid in this list using the suid and guid bits will be ignored. Here is an excerpt from the mount man page about the mount option.</p>
<p><a href="#id1"><span class="problematic" id="id2">``</span></a>`
nosuid</p>
<p>Do not allow set-user-identifier or set-group-identifier bits to take effect.
(This seems safe, but is in fact rather unsafe if you have suidperl(1) installed.)
<a href="#id3"><span class="problematic" id="id4">``</span></a><a href="#id5"><span class="problematic" id="id6">`</span></a></p>
<p>Another thing to note is that only binary files properly use SUID/GUID bits for security reasons. More on this
can be seen [here](<a class="reference external" href="http://unix.stackexchange.com/questions/130906/why-does-setuid-not-work">http://unix.stackexchange.com/questions/130906/why-does-setuid-not-work</a>).</p>
<p># SUID/GUID Example</p>
<p>SUID/GUID bits allow you to set the user or group that the program will be run as regardless of the user who executes the program.
More history on it can be found [here](<a class="reference external" href="http://www.thegeekstuff.com/2013/02/sticky-bit/">http://www.thegeekstuff.com/2013/02/sticky-bit/</a>).</p>
<p>The following will create a file that has the setUID bit set however since this only sets the setUID bit and
does not set the executable bit as well this does nothing and other users are not able to run this file as the
user who created the file [Reference](<a class="reference external" href="http://unix.stackexchange.com/questions/158448/what-is-the-purpose-of-setuid-enabled-with-no-executable-bit">http://unix.stackexchange.com/questions/158448/what-is-the-purpose-of-setuid-enabled-with-no-executable-bit</a>).</p>
<p>This was the example c program I used for seeing if SUID was being set how I expected.</p>
<p><a href="#id7"><span class="problematic" id="id8">``</span></a>`
// binary.c
#include &lt;stdio.h&gt;
#include &lt;stdlib.h&gt;
#include &lt;sys/types.h&gt;
#include &lt;unistd.h&gt;</p>
<p>int main()
{</p>
<blockquote>
<div>printf(“uid: %d n”, geteuid());
system(“id -u”);
return 0;</div></blockquote>
<div class="section" id="id9">
<h1>}<a class="headerlink" href="#id9" title="Permalink to this headline">¶</a></h1>
<p>Then I ran the following to set the SUID bit.</p>
<p><code class="docutils literal notranslate"><span class="pre">`</span>
<span class="pre">$</span> <span class="pre">gcc</span> <span class="pre">binary.c</span> <span class="pre">-o</span> <span class="pre">binary</span>
<span class="pre">$</span> <span class="pre">chmod</span> <span class="pre">u+s</span> <span class="pre">binary</span>
<span class="pre">$</span> <span class="pre">ls</span> <span class="pre">-la</span>
<span class="pre">total</span> <span class="pre">0</span>
<span class="pre">-rwSrw-r--</span>&#160; <span class="pre">1</span> <span class="pre">michael</span> <span class="pre">michael</span>&#160;&#160;&#160; <span class="pre">0</span> <span class="pre">nov</span> <span class="pre">26</span> <span class="pre">20:39</span> <span class="pre">binary</span>
<span class="pre">`</span></code></p>
<p>The following will make the file executable and then you can test running the file as another user.</p>
<p><code class="docutils literal notranslate"><span class="pre">`</span>
<span class="pre">$</span> <span class="pre">chmod</span> <span class="pre">+x</span> <span class="pre">binary</span>
<span class="pre">$</span> <span class="pre">ls</span> <span class="pre">-la</span>
<span class="pre">$</span> <span class="pre">ls</span> <span class="pre">-la</span>
<span class="pre">total</span> <span class="pre">0</span>
<span class="pre">-rwsrw-r--</span>&#160; <span class="pre">1</span> <span class="pre">michael</span> <span class="pre">michael</span>&#160;&#160;&#160; <span class="pre">0</span> <span class="pre">nov</span> <span class="pre">26</span> <span class="pre">20:39</span> <span class="pre">binary</span>
<span class="pre">`</span></code></p>
<p>Note the output when running the program as another user will show that the c call <cite>geteuid</cite> shows you the
expected uid of the user who created the file where <cite>id -u</cite> shows you your user id still. To clear this up
you will want to look at <cite>man geteuid</cite> and note the difference between uid and effective uid. This gist of
it is that the effective uid decides what permissions you have and the uid is the owner of the process.
More can be read about this [here](<a class="reference external" href="http://stackoverflow.com/questions/32455684/difference-between-real-user-id-effective-user-id-and-saved-user-id">http://stackoverflow.com/questions/32455684/difference-between-real-user-id-effective-user-id-and-saved-user-id</a>).</p>
<p>To enable you system calls to access the same files you will need to use the setreuid call before calling system.
Here is an example of using setreuid which would then allow all future system calls to access files on the system
in the same way as if you were the user who owned the binary.</p>
<p><code class="docutils literal notranslate"><span class="pre">`</span>
<span class="pre">if</span> <span class="pre">(setreuid(1000,</span> <span class="pre">1000))</span> <span class="pre">perror(&quot;setuid</span> <span class="pre">reported</span> <span class="pre">failure&quot;);</span>
<span class="pre">`</span></code></p>
<p>I won’t go into GUID because it works exactly the same as the above except with group id instead of user.</p>
<p># Stick Bit</p>
<p>The sticky bit is a permission bit that protects the files within a directory. If the directory has the
sticky bit set, a file can be deleted only by the owner of the file, the owner of the directory, or by root.
This special permission prevents a user from deleting other users’ files from public directories such as /tmp.</p>
<p>## Extra</p>
<ol class="arabic simple">
<li><a class="reference external" href="http://www.cis.syr.edu/~wedu/Teaching/IntrCompSec/LectureNotes_New/Set_UID.pdf">http://www.cis.syr.edu/~wedu/Teaching/IntrCompSec/LectureNotes_New/Set_UID.pdf</a></li>
<li><a class="reference external" href="http://stackoverflow.com/questions/24590735/setuid-does-not-work-for-non-root">http://stackoverflow.com/questions/24590735/setuid-does-not-work-for-non-root</a></li>
</ol>
</div>


          </div>
          
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<h1 class="logo"><a href="../index.html">Bookmarks</a></h1>








<h3>Navigation</h3>

<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="../index.html">Documentation overview</a><ul>
  </ul></li>
</ul>
</div>
<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    </div>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &copy;2018, Michael Schuett.
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 1.7.9</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.11</a>
      
      |
      <a href="../_sources/notes/stickybits.md.txt"
          rel="nofollow">Page source</a>
    </div>

    

    
  </body>
</html>