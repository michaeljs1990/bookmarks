

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>ioctl in Ruby &mdash; Bookmarks rc documentation</title>
  

  
  
  
  

  

  
  
    

  

  <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="prev" title="Ruby" href="index.html" /> 

  
  <script src="../_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="../index.html" class="icon icon-home"> Bookmarks
          

          
          </a>

          
            
            
              <div class="version">
                1.0
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../linux/index.html">Linux</a></li>
<li class="toctree-l1"><a class="reference internal" href="../linux/index.html#indices-and-tables">Indices and tables</a></li>
<li class="toctree-l1"><a class="reference internal" href="../networking/index.html">Networking</a></li>
<li class="toctree-l1"><a class="reference internal" href="../networking/index.html#indices-and-tables">Indices and tables</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="index.html">Ruby</a><ul class="current">
<li class="toctree-l2 current"><a class="current reference internal" href="#">ioctl in Ruby</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="index.html#indices-and-tables">Indices and tables</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">Bookmarks</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../index.html">Docs</a> &raquo;</li>
        
          <li><a href="index.html">Ruby</a> &raquo;</li>
        
      <li>ioctl in Ruby</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="../_sources/ruby/ioctl.md.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="ioctl-in-ruby">
<span id="ioctl-in-ruby"></span><h1>ioctl in Ruby<a class="headerlink" href="#ioctl-in-ruby" title="Permalink to this headline">¶</a></h1>
<p>I previously needed to tune the ring buffers on some server that I had and found that I needed to
install ethtool in order to read and set these values. At least if you are just going off what info
you will find online when you Google for how to do this. I figured you have to be able to do this in
a much easier way that doesn’t add any dependencies for me since I already have ruby on all my systems.
Additionally I imagine this is easy to do in any language such as Python which is default on almost all
linux OS now days.</p>
<p>The following script is what I came up with. I have broken this down line by line below for those who
may be unfamiliar with ioctl, ruby, or c.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="ch">#!/usr/bin/env ruby</span>

<span class="n">require</span> <span class="s1">&#39;socket&#39;</span>


<span class="n">SIOCETHTOOL</span> <span class="o">=</span> <span class="mh">0x8946</span>
<span class="n">ETHTOOL_GRINGPARAM</span> <span class="o">=</span> <span class="mh">0x00000010</span>
<span class="n">ETHTOOL_SRINGPARAM</span> <span class="o">=</span> <span class="mh">0x00000011</span>

<span class="n">sock</span> <span class="o">=</span> <span class="n">UDPSocket</span><span class="o">.</span><span class="n">new</span>

<span class="c1"># https://github.com/torvalds/linux/blob/9a76aba02a37718242d7cdc294f0a3901928aa57/include/uapi/linux/ethtool.h#L487</span>
<span class="n">ringparam_struct</span> <span class="o">=</span> <span class="p">[</span><span class="n">ETHTOOL_GRINGPARAM</span><span class="p">]</span><span class="o">.</span><span class="n">pack</span> <span class="s2">&quot;Vx32&quot;</span>
<span class="n">ifreq</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;enp0s31f6&quot;</span><span class="p">,</span> <span class="n">ringparam_struct</span><span class="p">]</span><span class="o">.</span><span class="n">pack</span> <span class="s2">&quot;a16P36&quot;</span>
<span class="n">sock</span><span class="o">.</span><span class="n">ioctl</span><span class="p">(</span><span class="n">SIOCETHTOOL</span><span class="p">,</span> <span class="n">ifreq</span><span class="p">)</span>

<span class="o">=</span><span class="n">begin</span>
  <span class="n">struct</span> <span class="n">ethtool_ringparam</span> <span class="o">-</span> <span class="n">RX</span><span class="o">/</span><span class="n">TX</span> <span class="n">ring</span> <span class="n">parameters</span>
  <span class="nd">@cmd</span><span class="p">:</span> <span class="n">Command</span> <span class="n">number</span> <span class="o">=</span> <span class="o">%</span><span class="n">ETHTOOL_GRINGPARAM</span> <span class="ow">or</span> <span class="o">%</span><span class="n">ETHTOOL_SRINGPARAM</span>
  <span class="nd">@rx_max_pending</span><span class="p">:</span> <span class="n">Maximum</span> <span class="n">supported</span> <span class="n">number</span> <span class="n">of</span> <span class="n">pending</span> <span class="n">entries</span> <span class="n">per</span>
       <span class="n">RX</span> <span class="n">ring</span><span class="o">.</span>  <span class="n">Read</span><span class="o">-</span><span class="n">only</span><span class="o">.</span>
  <span class="nd">@rx_mini_max_pending</span><span class="p">:</span> <span class="n">Maximum</span> <span class="n">supported</span> <span class="n">number</span> <span class="n">of</span> <span class="n">pending</span> <span class="n">entries</span>
       <span class="n">per</span> <span class="n">RX</span> <span class="n">mini</span> <span class="n">ring</span><span class="o">.</span>  <span class="n">Read</span><span class="o">-</span><span class="n">only</span><span class="o">.</span>
  <span class="nd">@rx_jumbo_max_pending</span><span class="p">:</span> <span class="n">Maximum</span> <span class="n">supported</span> <span class="n">number</span> <span class="n">of</span> <span class="n">pending</span> <span class="n">entries</span>
       <span class="n">per</span> <span class="n">RX</span> <span class="n">jumbo</span> <span class="n">ring</span><span class="o">.</span>  <span class="n">Read</span><span class="o">-</span><span class="n">only</span><span class="o">.</span>
  <span class="nd">@tx_max_pending</span><span class="p">:</span> <span class="n">Maximum</span> <span class="n">supported</span> <span class="n">number</span> <span class="n">of</span> <span class="n">pending</span> <span class="n">entries</span> <span class="n">per</span>
       <span class="n">TX</span> <span class="n">ring</span><span class="o">.</span>  <span class="n">Read</span><span class="o">-</span><span class="n">only</span><span class="o">.</span>
  <span class="nd">@rx_pending</span><span class="p">:</span> <span class="n">Current</span> <span class="n">maximum</span> <span class="n">number</span> <span class="n">of</span> <span class="n">pending</span> <span class="n">entries</span> <span class="n">per</span> <span class="n">RX</span> <span class="n">ring</span>
  <span class="nd">@rx_mini_pending</span><span class="p">:</span> <span class="n">Current</span> <span class="n">maximum</span> <span class="n">number</span> <span class="n">of</span> <span class="n">pending</span> <span class="n">entries</span> <span class="n">per</span> <span class="n">RX</span>
       <span class="n">mini</span> <span class="n">ring</span>
  <span class="nd">@rx_jumbo_pending</span><span class="p">:</span> <span class="n">Current</span> <span class="n">maximum</span> <span class="n">number</span> <span class="n">of</span> <span class="n">pending</span> <span class="n">entries</span> <span class="n">per</span> <span class="n">RX</span>
       <span class="n">jumbo</span> <span class="n">ring</span>
  <span class="nd">@tx_pending</span><span class="p">:</span> <span class="n">Current</span> <span class="n">maximum</span> <span class="n">supported</span> <span class="n">number</span> <span class="n">of</span> <span class="n">pending</span> <span class="n">entries</span>
       <span class="n">per</span> <span class="n">TX</span> <span class="n">ring</span>
<span class="o">=</span><span class="n">end</span>
<span class="n">rv</span> <span class="o">=</span>  <span class="n">ringparam_struct</span><span class="o">.</span><span class="n">unpack</span> <span class="s2">&quot;V9&quot;</span>

<span class="c1"># pop off the GRINGPARAM cmd from the struct</span>
<span class="n">_</span><span class="p">,</span> <span class="o">*</span><span class="n">tail</span> <span class="o">=</span> <span class="n">rv</span>

<span class="c1"># To see what is all changable by the user you can read the source code here</span>
<span class="c1"># https://github.com/torvalds/linux/blob/9a76aba02a37718242d7cdc294f0a3901928aa57/drivers/net/ethernet/freescale/gianfar_ethtool.c#L419</span>
<span class="n">ifreq</span> <span class="o">=</span> <span class="n">tail</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">ETHTOOL_SRINGPARAM</span><span class="p">)</span>
<span class="n">ifreq</span><span class="p">[</span><span class="mi">5</span><span class="p">]</span> <span class="o">=</span> <span class="mi">512</span>
<span class="n">ifreq</span><span class="p">[</span><span class="mi">8</span><span class="p">]</span> <span class="o">=</span> <span class="mi">512</span>

<span class="c1"># Now lets set the data</span>
<span class="n">ringparam_struct</span> <span class="o">=</span> <span class="n">ifreq</span><span class="o">.</span><span class="n">pack</span> <span class="s2">&quot;V9&quot;</span>
<span class="n">ifreq</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;enp0s31f6&quot;</span><span class="p">,</span> <span class="n">ringparam_struct</span><span class="p">]</span><span class="o">.</span><span class="n">pack</span> <span class="s2">&quot;a16P36&quot;</span>
<span class="n">sock</span><span class="o">.</span><span class="n">ioctl</span><span class="p">(</span><span class="n">SIOCETHTOOL</span><span class="p">,</span> <span class="n">ifreq</span><span class="p">)</span>
</pre></div>
</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
      
        <a href="index.html" class="btn btn-neutral" title="Ruby" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2018, Michael Schuett.

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'../',
            VERSION:'rc',
            LANGUAGE:'None',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true,
            SOURCELINK_SUFFIX: '.txt'
        };
    </script>
      <script type="text/javascript" src="../_static/jquery.js"></script>
      <script type="text/javascript" src="../_static/underscore.js"></script>
      <script type="text/javascript" src="../_static/doctools.js"></script>

  

  <script type="text/javascript" src="../_static/js/theme.js"></script>

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>